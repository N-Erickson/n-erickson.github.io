<!DOCTYPE html>
<html>
<head>
    <title>Local Sioux Falls Headlines</title>
    <meta http-equiv="refresh" content="300">
    <style>
        @font-face {
            font-family: 'Star 4 Radar';
            src: url('fonts/Star 4 Radar.ttf');
        }
        #reminderContainer {
            width: 400px;
            height: 900px;
            background: #063359;
            position: absolute;
            top: 0;
            left: 0;
            overflow: hidden;
            color: white;
            font-family: Arial, sans-serif; /* Fallback font if Star 4 Radar isn't available */
            box-shadow: 0px 0px 20px #FB8807;
        }
        #reminderHeader {
            width: 100%;
            height: 26px;
            background: #FB8807;
            text-align: center;
            font-size: 24px;
            line-height: 26px;
            font-family: 'Star 4 Radar', Arial, sans-serif;
        }
        #reminderContent {
            width: 100%;
            height: calc(100% - 26px);
            overflow: hidden;
            position: relative;
        }
        #newsList {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            transition: transform 0.5s ease;
        }
        .newsItem {
            display: flex;
            padding: 15px;
            border-bottom: 1px solid #FB8807;
            background: rgba(251, 136, 7, 0.1);
            margin-bottom: 5px;
        }
        .newsItem img {
            width: 80px;
            height: 80px;
            margin-right: 15px;
            object-fit: cover;
            border: 2px solid #FB8807;
            border-radius: 4px;
        }
        .newsItem a {
            color: #FB8807;
            text-decoration: none;
            font-size: 16px;
            font-weight: bold;
            display: block;
            margin-bottom: 8px;
        }
        .newsItem a:hover {
            text-decoration: underline;
        }
        .newsSummary {
            color: #ffffff;
            font-size: 14px;
            line-height: 1.4;
        }
        #errorMessage {
            color: #FB8807;
            text-align: center;
            padding: 20px;
            display: none;
        }
        .newsContent {
            flex: 1;
        }
    </style>
</head>
<body>
    <div id="reminderContainer">
        <div id="reminderHeader">
            <span>Local Sioux Falls Headlines</span>
        </div>
        <div id="reminderContent">
            <div id="errorMessage"></div>
            <div id="newsList"></div>
        </div>
    </div>

    <script>
        const PROXY_URLS = [
            'https://api.allorigins.win/raw?url=',
            'https://cors-anywhere.herokuapp.com/',
            'https://api.rss2json.com/v1/api.json?rss_url='
        ];

        async function tryFetchWithProxy(rssUrl, proxyUrl) {
            try {
                const response = await fetch(proxyUrl + encodeURIComponent(rssUrl));
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.text();
                return data;
            } catch (error) {
                console.error(`Error with proxy ${proxyUrl}:`, error);
                return null;
            }
        }

        async function fetchNews() {
            const rssUrl = 'https://news.google.com/rss/search?q=location:Sioux+Falls+when:7d&hl=en-US&gl=US&ceid=US:en';
            const newsList = document.getElementById('newsList');
            const errorMessage = document.getElementById('errorMessage');
            
            let success = false;
            
            for (const proxyUrl of PROXY_URLS) {
                const data = await tryFetchWithProxy(rssUrl, proxyUrl);
                if (data) {
                    try {
                        const parser = new DOMParser();
                        const xmlDoc = parser.parseFromString(data, "text/xml");
                        
                        if (!xmlDoc.getElementsByTagName('parsererror').length) {
                            await processNewsItems(xmlDoc);
                            success = true;
                            break;
                        }
                    } catch (error) {
                        console.error('Error processing XML:', error);
                    }
                }
            }

            if (!success) {
                errorMessage.style.display = 'block';
                errorMessage.textContent = 'Unable to load news. Please try again later.';
            } else {
                errorMessage.style.display = 'none';
                startScrolling();
            }
        }

        async function processNewsItems(xmlDoc) {
            const items = xmlDoc.getElementsByTagName('item');
            const newsList = document.getElementById('newsList');
            newsList.innerHTML = ''; // Clear existing items

            for (let i = 0; i < Math.min(items.length, 10); i++) {
                const item = items[i];
                const newsItem = document.createElement('div');
                newsItem.className = 'newsItem';

                const title = item.getElementsByTagName('title')[0]?.textContent || 'No Title';
                const link = item.getElementsByTagName('link')[0]?.textContent || '#';
                let description = item.getElementsByTagName('description')[0]?.textContent || '';

                // Clean up description
                description = description.replace(/<[^>]*>/g, '');
                description = description.trim().substring(0, 150) + '...';

                // Create image with fallback
                const img = document.createElement('img');
                img.src = 'https://via.placeholder.com/80/FB8807/FFFFFF?text=SF+News';
                img.onerror = () => img.src = 'https://via.placeholder.com/80/FB8807/FFFFFF?text=SF+News';

                // Create content wrapper
                const contentDiv = document.createElement('div');
                contentDiv.className = 'newsContent';

                // Add title and description
                contentDiv.innerHTML = `
                    <a href="${link}" target="_blank">${title}</a>
                    <div class="newsSummary">${description}</div>
                `;

                newsItem.appendChild(img);
                newsItem.appendChild(contentDiv);
                newsList.appendChild(newsItem);
            }
        }

        function startScrolling() {
            const newsList = document.getElementById('newsList');
            const container = document.getElementById('reminderContent');
            let scrollPosition = 0;
            const scrollSpeed = 1;
            let isPaused = false;

            // Add pause on hover
            container.addEventListener('mouseenter', () => isPaused = true);
            container.addEventListener('mouseleave', () => isPaused = false);

            setInterval(() => {
                if (!isPaused) {
                    scrollPosition += scrollSpeed;
                    const maxScroll = newsList.scrollHeight - container.clientHeight;
                    
                    if (scrollPosition >= maxScroll) {
                        // Smooth reset to top
                        scrollPosition = 0;
                    }
                    
                    newsList.style.transform = `translateY(-${scrollPosition}px)`;
                }
            }, 50);
        }

        // Initial fetch and refresh every 5 minutes
        fetchNews();
        setInterval(fetchNews, 300000);
    </script>
</body>
</html>
